/**
 * @file: code_player.js
 * This file implements code player.
 */var CodePlayer=function(){return function(a){this.record_url,this.options={schedule_record_after:3e3},a!==undefined&&a.animate_save!==undefined?this.animate_save=a.animate_save:this.animate_save=null,this.changeset_queue=[],this.record_settimeout_id=null,this.final_code=null,this.is_record_pending=!1,$.extend(this.options,a),this.enqueue_changeset=function(a,b,c,d){if(a){var e={delta:a,source:b,timestamp:c?c:(new Date).getTime()};this.changeset_queue.push(e)}return this.final_code=d,!0},this.setRecordUrl=function(a){this.record_url=a},this.isSetupDone=function(){return!!this.record_url},this.restartRecordingAfterNetworkLost=function(){this.is_record_pending&&(this.is_record_pending=!1,this.start_recording(0))},this.is_recording_code_player=!1,this.start_recording=function(a){if(g_record_request_failed){this.is_record_pending=!0;return}if(!this.record_url)return;var b=this.restartRecordingAfterNetworkLost.bind(this);this.is_recording_code_player=!0,this.stop_recording();var c=this,d=function(){return function(){var a=c.changeset_queue,d=c.record_url,e=a.length,f=c.final_code,g=null;e&&(g=a.splice(0,e));var h=0;record_changesets(g,f,d,h,b,c.animate_save),c.is_recording_code_player=!1}}(c);a===undefined&&(a=this.options.schedule_record_after),this.record_settimeout_id=setTimeout(d,a)},this.stop_recording=function(){this.is_recording()&&clearTimeout(this.record_settimeout_id),this.record_settimeout_id=null},this.is_recording=function(){return this.record_settimeout_id?!0:!1},this.finish_recording=function(a){var b=this.changeset_queue,c=this.record_url,d=b.length,e=this.final_code,f=null;d&&(f=b.splice(0,d));var g=0;record_changesets(f,e,c,g,a,this.animate_save)}}}();