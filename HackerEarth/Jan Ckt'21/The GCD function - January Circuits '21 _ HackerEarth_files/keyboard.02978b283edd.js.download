/**
 * Title: KeyboardJS
 * Version: v0.4.1
 * Description: KeyboardJS is a flexible and easy to use keyboard binding
 * library.
 * Author: Robert Hurst.
 *
 * Copyright 2011, Robert William Hurst
 * Licenced under the BSD License.
 * See https://raw.github.com/RobertWHurst/KeyboardJS/master/license.txt
 */(function(a,b){function c(){function c(a){var d;return d=b(a,"amd"),d.fork=c,d}return c(a)}function d(){function c(a){var d;return d=b(a,"CommonJS"),d.fork=c,d}module.exports=c(a);return}function e(){function d(a){function g(){var b,d,g;g=Array.prototype.slice.apply(arguments);for(d=0;d<e.length;d+=1)typeof f[e[d]]=="undefined"?delete a[e[d]]:a[e[d]]=f[e[d]];f={};for(d=0;d<g.length;d+=1){if(typeof g[d]!="string")throw new Error("Cannot replace namespaces. All new namespaces must be strings.");f[g[d]]=a[g[d]],a[g[d]]=c}return e=g,e}var c,e=[],f={};return c=b(a,"global"),c.fork=d,c.noConflict=g,c.noConflict("KeyboardJS","k"),c}var c;c=d(a)}[].indexOf||(Array.prototype.indexOf=function(a,b,c){for(c=this.length,b=(c+~~b)%c;b<c&&(!(b in this)||this[b]!==a);b++);return b^c?b:-1}),typeof define=="function"&&define.amd?define(c):typeof module!="undefined"?d():e()})(this,function(a,b){function n(){a.addEventListener?(a.document.addEventListener("keydown",q,!1),a.document.addEventListener("keyup",r,!1),a.addEventListener("blur",p,!1),a.addEventListener("webkitfullscreenchange",p,!1),a.addEventListener("mozfullscreenchange",p,!1)):a.attachEvent&&(a.document.attachEvent("onkeydown",q),a.document.attachEvent("onkeyup",r),a.attachEvent("onblur",p))}function o(){p(),a.removeEventListener?(a.document.removeEventListener("keydown",q,!1),a.document.removeEventListener("keyup",r,!1),a.removeEventListener("blur",p,!1),a.removeEventListener("webkitfullscreenchange",p,!1),a.removeEventListener("mozfullscreenchange",p,!1)):a.detachEvent&&(a.document.detachEvent("onkeydown",q),a.document.detachEvent("onkeyup",r),a.detachEvent("onblur",p))}function p(a){h=[],x(),C(a)}function q(a){var b,c,d;b=s(a.keyCode);if(b.length<1)return;a.isRepeat=!1;for(d=0;d<b.length;d+=1)c=b[d],I().indexOf(c)!=-1&&(a.isRepeat=!0),J(c);w(),B(a)}function r(a){var b,c;b=s(a.keyCode);if(b.length<1)return;for(c=0;c<b.length;c+=1)K(b[c]);x(),C(a)}function s(a){return f[a]||[]}function t(a){var b;for(b in f){if(!f.hasOwnProperty(b))continue;if(f[b].indexOf(a)>-1)return b}return!1}function u(a,b){if(typeof a!="string"&&(typeof a!="object"||typeof a.push!="function"))throw new Error("Cannot create macro. The combo must be a string or array.");if(typeof b!="object"||typeof b.push!="function")throw new Error("Cannot create macro. The injectedKeys must be an array.");g.push([a,b])}function v(a){var b;if(typeof a!="string"&&(typeof a!="object"||typeof a.push!="function"))throw new Error("Cannot remove macro. The combo must be a string or array.");for(mI=0;mI<g.length;mI+=1){b=g[mI];if(D(a,b[0])){K(b[1]),g.splice(mI,1);break}}}function w(){var a,b,c;for(a=0;a<g.length;a+=1){b=G(g[a][0]);if(k.indexOf(g[a])===-1&&E(b)){k.push(g[a]);for(c=0;c<g[a][1].length;c+=1)J(g[a][1][c])}}}function x(){var a,b,c;for(a=0;a<k.length;a+=1){b=G(k[a][0]);if(E(b)===!1){for(c=0;c<k[a][1].length;c+=1)K(k[a][1][c]);k.splice(a,1),a-=1}}}function y(a,b,c){function k(){var a;for(a=0;a<f.length;a+=1)i.splice(i.indexOf(f[a]),1)}function l(a){function g(){var b,d;for(b=0;b<c.length;b+=1)if(typeof c[b]=="function")if(a==="keyup")for(d=0;d<f.length;d+=1)f[d].keyUpCallback.splice(f[d].keyUpCallback.indexOf(c[b]),1);else for(d=0;d<f.length;d+=1)f[d].keyDownCallback.splice(f[d].keyDownCallback.indexOf(c[b]),1)}var b={},c,d,e;if(typeof a!="string")throw new Error("Cannot bind callback. The event name must be a string.");if(a!=="keyup"&&a!=="keydown")throw new Error('Cannot bind callback. The event name must be a "keyup" or "keydown".');c=Array.prototype.slice.apply(arguments,[1]);for(d=0;d<c.length;d+=1)if(typeof c[d]=="function")if(a==="keyup")for(e=0;e<f.length;e+=1)f[e].keyUpCallback.push(c[d]);else if(a==="keydown")for(e=0;e<f.length;e+=1)f[e].keyDownCallback.push(c[d]);return b.clear=g,b}var d={},e,f=[],g={},h,j;typeof a=="string"&&(a=G(a));for(h=0;h<a.length;h+=1){e={},j=H([a[h]]);if(typeof j!="string")throw new Error("Failed to bind key combo. The key combo must be string.");e.keyCombo=j,e.keyDownCallback=[],e.keyUpCallback=[],b&&e.keyDownCallback.push(b),c&&e.keyUpCallback.push(c),i.push(e),f.push(e)}return d.clear=k,d.on=l,d}function z(a){var b,c,d;for(b=0;b<i.length;b+=1)c=i[b],D(a,c.keyCombo)&&(i.splice(b,1),b-=1)}function A(a){var b,c,d;if(a)for(b=0;b<i.length;b+=1){d=i[b];for(c=0;c<d.keyCombo.length;c+=1)if(d.keyCombo[c].indexOf(a)>-1){i.splice(b,1),b-=1;break}}else i=[]}function B(a){var b,c,d,e,f,g,k,l,m,n,o=[],p;f=[].concat(h);for(b=0;b<i.length;b+=1)p=F(i[b].keyCombo).length,o[p]||(o[p]=[]),o[p].push(i[b]);for(c=o.length-1;c>=0;c-=1){if(!o[c])continue;for(b=0;b<o[c].length;b+=1){d=o[c][b],e=F(d.keyCombo),m=!0;for(l=0;l<e.length;l+=1)if(f.indexOf(e[l])===-1){m=!1;break}if(m&&E(d.keyCombo)){j.push(d);for(l=0;l<e.length;l+=1)n=f.indexOf(e[l]),n>-1&&(f.splice(n,1),l-=1);for(g=0;g<d.keyDownCallback.length;g+=1)d.keyDownCallback[g](a,I(),d.keyCombo)===!1&&(k=!0);k===!0&&(a.preventDefault(),a.stopPropagation())}}}}function C(a){var b,c,d,e;for(b=0;b<j.length;b+=1){d=j[b];if(E(d.keyCombo)===!1){for(c=0;c<d.keyUpCallback.length;c+=1)d.keyUpCallback[c](a,I(),d.keyCombo)===!1&&(e=!0);e===!0&&(a.preventDefault(),a.stopPropagation()),j.splice(b,1),b-=1}}}function D(a,b){var c,d,e;a=G(a),b=G(b);if(a.length!==b.length)return!1;for(c=0;c<a.length;c+=1){if(a[c].length!==b[c].length)return!1;for(d=0;d<a[c].length;d+=1){if(a[c][d].length!==b[c][d].length)return!1;for(e=0;e<a[c][d].length;e+=1)if(b[c][d].indexOf(a[c][d][e])===-1)return!1}}return!0}function E(a){var b,c,d,e,f=0,g,i;a=G(a);for(b=0;b<a.length;b+=1){i=!0,f=0;for(c=0;c<a[b].length;c+=1){d=[].concat(a[b][c]);for(e=f;e<h.length;e+=1)g=d.indexOf(h[e]),g>-1&&(d.splice(g,1),f=e);if(d.length!==0){i=!1;break}}if(i)return!0}return!1}function F(a){var b,c,d,e=[];a=G(a);for(b=0;b<a.length;b+=1)for(c=0;c<a[b].length;c+=1)e=e.concat(a[b][c]);return e}function G(a){var b=a,c=0,d=0,e=!1,f=!1,g=[],h=[],i=[],j="";if(typeof a=="object"&&typeof a.push=="function")return a;if(typeof a!="string")throw new Error('Cannot parse "keyCombo" because its type is "'+typeof a+'". It must be a "string".');while(b.charAt(c)===" ")c+=1;for(;;){if(b.charAt(c)===" "){while(b.charAt(c)===" ")c+=1;e=!0}else if(b.charAt(c)===","){if(d||f)throw new Error("Failed to parse key combo. Unexpected , at character index "+c+".");f=!0,c+=1}else if(b.charAt(c)==="+"){j.length&&(i.push(j),j="");if(d||f)throw new Error("Failed to parse key combo. Unexpected + at character index "+c+".");d=!0,c+=1}else if(b.charAt(c)===">"){j.length&&(i.push(j),j=""),i.length&&(h.push(i),i=[]);if(d||f)throw new Error("Failed to parse key combo. Unexpected > at character index "+c+".");d=!0,c+=1}else if(c<b.length-1&&b.charAt(c)==="!"&&(b.charAt(c+1)===">"||b.charAt(c+1)===","||b.charAt(c+1)==="+"))j+=b.charAt(c+1),d=!1,e=!1,f=!1,c+=2;else{if(!(c<b.length&&b.charAt(c)!=="+"&&b.charAt(c)!==">"&&b.charAt(c)!==","&&b.charAt(c)!==" ")){c+=1;continue}if(d===!1&&e===!0||f===!0)j.length&&(i.push(j),j=""),i.length&&(h.push(i),i=[]),h.length&&(g.push(h),h=[]);d=!1,e=!1,f=!1;while(c<b.length&&b.charAt(c)!=="+"&&b.charAt(c)!==">"&&b.charAt(c)!==","&&b.charAt(c)!==" ")j+=b.charAt(c),c+=1}if(c>=b.length){j.length&&(i.push(j),j=""),i.length&&(h.push(i),i=[]),h.length&&(g.push(h),h=[]);break}}return g}function H(a){var b,c,d=[];if(typeof a=="string")return a;if(typeof a!="object"||typeof a.push!="function")throw new Error("Cannot stringify key combo.");for(b=0;b<a.length;b+=1){d[b]=[];for(c=0;c<a[b].length;c+=1)d[b][c]=a[b][c].join(" + ");d[b]=d[b].join(" > ")}return d.join(" ")}function I(){return[].concat(h)}function J(a){if(a.match(/\s/))throw new Error("Cannot add key name "+a+" to active keys because it contains whitespace.");if(h.indexOf(a)>-1)return;h.push(a)}function K(a){var b=t(a);b==="91"||b==="92"?h=[]:h.splice(h.indexOf(a),1)}function L(a,b){if(typeof a!="string")throw new Error("Cannot register new locale. The locale name must be a string.");if(typeof b!="object")throw new Error("Cannot register "+a+" locale. The locale map must be an object.");if(typeof b.map!="object")throw new Error("Cannot register "+a+" locale. The locale map is invalid.");b.macros||(b.macros=[]),d[a]=b}function M(a){if(a){if(typeof a!="string")throw new Error("Cannot set locale. The locale name must be a string.");if(!d[a])throw new Error("Cannot set locale to "+a+" because it does not exist. If you would like to submit a "+a+" locale map for KeyboardJS please submit it at https://github.com/RobertWHurst/KeyboardJS/issues.");f=d[a].map,g=d[a].macros,e=a}return e}var c={},d={},e,f,g,h=[],i=[],j=[],k=[],l,m;a=a||window,m={map:{3:["cancel"],8:["backspace"],9:["tab"],12:["clear"],13:["enter"],16:["shift"],17:["ctrl"],18:["alt","menu"],19:["pause","break"],20:["capslock"],27:["escape","esc"],32:["space","spacebar"],33:["pageup"],34:["pagedown"],35:["end"],36:["home"],37:["left"],38:["up"],39:["right"],40:["down"],41:["select"],42:["printscreen"],43:["execute"],44:["snapshot"],45:["insert","ins"],46:["delete","del"],47:["help"],91:["command","windows","win","super","leftcommand","leftwindows","leftwin","leftsuper"],92:["command","windows","win","super","rightcommand","rightwindows","rightwin","rightsuper"],145:["scrolllock","scroll"],186:["semicolon",";"],187:["equal","equalsign","="],188:["comma",","],189:["dash","-"],190:["period","."],191:["slash","forwardslash","/"],192:["graveaccent","`"],219:["openbracket","["],220:["backslash","\\"],221:["closebracket","]"],222:["apostrophe","'"],48:["zero","0"],49:["one","1"],50:["two","2"],51:["three","3"],52:["four","4"],53:["five","5"],54:["six","6"],55:["seven","7"],56:["eight","8"],57:["nine","9"],96:["numzero","num0"],97:["numone","num1"],98:["numtwo","num2"],99:["numthree","num3"],100:["numfour","num4"],101:["numfive","num5"],102:["numsix","num6"],103:["numseven","num7"],104:["numeight","num8"],105:["numnine","num9"],106:["nummultiply","num*"],107:["numadd","num+"],108:["numenter"],109:["numsubtract","num-"],110:["numdecimal","num."],111:["numdivide","num/"],144:["numlock","num"],112:["f1"],113:["f2"],114:["f3"],115:["f4"],116:["f5"],117:["f6"],118:["f7"],119:["f8"],120:["f9"],121:["f10"],122:["f11"],123:["f12"]},macros:[["shift + `",["tilde","~"]],["shift + 1",["exclamation","exclamationpoint","!"]],["shift + 2",["at","@"]],["shift + 3",["number","#"]],["shift + 4",["dollar","dollars","dollarsign","$"]],["shift + 5",["percent","%"]],["shift + 6",["caret","^"]],["shift + 7",["ampersand","and","&"]],["shift + 8",["asterisk","*"]],["shift + 9",["openparen","("]],["shift + 0",["closeparen",")"]],["shift + -",["underscore","_"]],["shift + =",["plus","+"]],["shift + (",["opencurlybrace","opencurlybracket","{"]],["shift + )",["closecurlybrace","closecurlybracket","}"]],["shift + \\",["verticalbar","|"]],["shift + ;",["colon",":"]],["shift + '",["quotationmark",'"']],["shift + !,",["openanglebracket","<"]],["shift + .",["closeanglebracket",">"]],["shift + /",["questionmark","?"]]]};for(l=65;l<=90;l+=1)m.map[l]=String.fromCharCode(l+32),m.macros.push(["shift + "+String.fromCharCode(l+32)+", capslock + "+String.fromCharCode(l+32),[String.fromCharCode(l)]]);return L("us",m),M("us"),n(),c.enable=n,c.disable=o,c.activeKeys=I,c.releaseKey=K,c.pressKey=J,c.on=y,c.clear=z,c.clear.key=A,c.locale=M,c.locale.register=L,c.macro=u,c.macro.remove=v,c.key={},c.key.name=s,c.key.code=t,c.combo={},c.combo.active=E,c.combo.parse=G,c.combo.stringify=H,c});